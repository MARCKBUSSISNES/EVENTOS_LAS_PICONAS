<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Sistema Offline - Las Piconas (Touch)</title>
<style>
:root{--bg:#0b0f14;--panel:#0f1720;--card:#0b1220;--accent:#ff6b35;--muted:#9aa4b2;--glass:rgba(255,255,255,0.03);}
*{box-sizing:border-box;font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, Arial, sans-serif;}
html,body{height:100%;margin:0;background:linear-gradient(180deg,#06080a 0%, #0b0f14 100%);color:#e6eef6;}
.app{display:grid;grid-template-columns:360px 1fr 360px;gap:14px;padding:14px;height:100vh;}
.sidebar{background:var(--panel);border-radius:12px;padding:12px;display:flex;flex-direction:column;box-shadow:0 6px 18px rgba(2,6,23,0.6);}
.brand{font-weight:800;letter-spacing:0.6px;padding:8px 12px;font-size:18px;text-align:center;color:#fff;}
.logo-preview{max-width:140px;margin:6px auto 8px;display:block;}
.controls-row{display:flex;gap:8px;margin-bottom:8px;}
.input, .qty{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:10px;border-radius:8px;color:#e6eef6;}
.categorias{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px;}
.cat-btn{padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);cursor:pointer;font-weight:700;min-width:80px;}
.products{margin-top:12px;display:grid;grid-template-columns:repeat(3,1fr);gap:10px;overflow:auto;padding:6px;height:calc(100vh - 420px);}
.prod-btn{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.04);padding:12px;border-radius:10px;cursor:pointer;text-align:center;user-select:none;color:#fff;}
.prod-name{font-weight:800;}
.prod-price{font-size:13px;color:var(--muted);margin-top:6px;}
.center{background:var(--card);border-radius:12px;padding:12px;display:flex;flex-direction:column;box-shadow:0 6px 18px rgba(2,6,23,0.6);}
.viewer{flex:1;background:linear-gradient(180deg,#071428,#071a2a);padding:12px;border-radius:10px;overflow:auto;}
.item-row{display:flex;justify-content:space-between;align-items:center;gap:8px;padding:8px;border-bottom:1px dashed rgba(255,255,255,0.03);}
.item-actions{display:flex;gap:6px;}
.action-btn{background:transparent;border:1px solid rgba(255,255,255,0.06);color:#fff;padding:6px 8px;border-radius:8px;cursor:pointer;}
.controls{display:flex;gap:8px;margin-top:10px;}
.control-btn{flex:1;padding:12px;border-radius:8px;background:var(--accent);color:#0b1220;font-weight:800;border:none;cursor:pointer;}
.small{padding:8px;font-size:14px;}
.right{background:var(--panel);border-radius:12px;padding:12px;display:flex;flex-direction:column;box-shadow:0 6px 18px rgba(2,6,23,0.6);}
.summary{background:linear-gradient(180deg,#071428,#071a2a);border-radius:10px;padding:12px;margin-bottom:12px;}
.kv{display:flex;justify-content:space-between;color:var(--muted);padding:6px 0;}
.history{flex:1;overflow:auto;}
.row{display:flex;justify-content:space-between;align-items:center;padding:8px;border-radius:8px;margin-bottom:8px;background:rgba(255,255,255,0.02);}
.footer{font-size:12px;color:var(--muted);text-align:center;margin-top:8px;}
.big-btn{background:linear-gradient(90deg,#111827,#0b1220);border:2px solid rgba(255,255,255,0.04);color:#fff;padding:12px;border-radius:10px;font-weight:800;}
.topbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;}
.current-order{font-size:20px;font-weight:900;text-align:center;}
.cat-MEDIANAS{background:#0f4bff;}
.cat-JUMBOS{background:#16a34a;}
.cat-TACOS{background:#7c3aed;}
.cat-BEBIDAS{background:#f97316;}
.cat-POSTRES_Y_EXTRAS{background:#ef4444;}
.cat-MEDIANAS,.cat-JUMBOS,.cat-TACOS,.cat-BEBIDAS,.cat-POSTRES_Y_EXTRAS{color:#fff;padding:8px;border-radius:8px;border:none;}
@media print{body *{visibility:hidden}.print-area, .print-area *{visibility:visible}.print-area{position:fixed;left:0;top:0;width:100%}}
.login-wrap{position:fixed;inset:0;background:linear-gradient(90deg, rgba(2,6,23,0.9), rgba(4,10,27,0.95));display:flex;align-items:center;justify-content:center;z-index:999;}
.login-card{background:linear-gradient(180deg,#071428,#0b1220);padding:28px;border-radius:12px;min-width:360px;box-shadow:0 8px 30px rgba(2,6,23,0.7);color:#fff;}
.login-card h2{text-align:center;margin:6px 0 12px;}
.login-card .input{width:100%;margin-bottom:10px;}
.login-logo{max-width:140px;display:block;margin:0 auto 10px;}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="login" class="login-wrap">
  <div class="login-card">
    <img src="logo.png" class="login-logo" onerror="this.style.display='none'"/>
    <h2>Ingreso al Sistema</h2>
    <input id="user" class="input" placeholder="Usuario" value="" />
    <input id="pass" class="input" placeholder="Clave" type="password" />
    <div style="display:flex;gap:8px;margin-top:8px">
      <button id="btnLogin" class="big-btn" style="flex:1">Entrar</button>
    </div>
    <div style="text-align:center;margin-top:10px;color:var(--muted);font-size:13px">
      Usuario: <b>CAJERO</b> — Clave: <b>123</b>
    </div>
  </div>
</div>

<div class="app" id="appRoot" style="display:none;">
  <div class="sidebar">
    <div class="brand">Las Piconas - Punto de Venta (Touch)</div>
    <img src="logo.png" alt="logo" class="logo-preview" onerror="this.style.display='none'" />
    
    <!-- BOTONES NUEVAS CATEGORIAS / PRODUCTOS -->
    <div style="margin-top:12px">
      <button id="btnAddCategory" class="big-btn" style="margin-bottom:6px">+ Nueva Categoría</button>
      <button id="btnAddProduct" class="big-btn">+ Nuevo Producto</button>
    </div>

    <div class="controls-row">
      <input id="qty" class="qty" type="number" value="1" min="1" style="flex:1" />
      <button id="btnDeleteLast" class="action-btn">Borrar último</button>
    </div>

    <div style="margin-top:6px">
      <div style="font-size:13px;color:var(--muted);padding:6px">Categorías</div>
      <div class="categorias" id="categorias"></div>
    </div>

    <div style="margin-top:12px">
      <div style="font-size:13px;color:var(--muted);padding:6px">Productos</div>
      <div class="products" id="products"></div>
    </div>
  </div>

  <div class="center">
    <div class="topbar">
      <div style="font-weight:800;font-size:18px">Visor de Cliente</div>
      <div style="display:flex;gap:8px">
        <button id="btn-cash" class="action-btn">Efectivo</button>
        <button id="btn-card" class="action-btn">Tarjeta</button>
      </div>
    </div>
    <div class="current-order" id="currentOrder">Orden: A 1</div>
    <div class="viewer" id="viewer"></div>
    <div class="controls">
      <button id="minus" class="action-btn small">-</button>
      <button id="plus" class="action-btn small">+</button>
      <button id="coupon" class="action-btn small">Descuento Q</button>
      <button id="finalizar" class="control-btn">Cobrar & Generar Tickets</button>
    </div>
  </div>

  <div class="right">
    <div class="summary">
      <div class="kv"><div>Subtotal</div><div id="subtotal">Q0.00</div></div>
      <div class="kv"><div>Descuento</div><div id="discount">Q0.00</div></div>
      <div class="kv" style="font-weight:800;margin-top:8px"><div>Total</div><div id="total">Q0.00</div></div>
    </div>

    <div style="margin-bottom:8px">
      <div style="font-size:13px;color:var(--muted);margin-bottom:6px">Historial / Reimprimir</div>
      <div style="display:flex;gap:8px;margin-bottom:8px">
        <input id="searchId" class="input" placeholder="Buscar por id u orden..." />
        <button id="btnSearch" class="action-btn">Buscar</button>
      </div>
      <div style="display:flex;gap:8px;margin-bottom:8px">
        <button id="btnCloseShift" class="big-btn" style="flex:1;background:linear-gradient(90deg,#7c3aed,#6d28d9)">Cierre de Turno</button>
        <button id="btnExport" class="action-btn">Exportar</button>
      </div>
      <div class="history" id="history"></div>
    </div>
    <div class="footer">Powered by Marck Business - Tecnología para tu negocio</div>
  </div>
</div>

<script>
// --- Datos iniciales ---
let CATEGORIES = JSON.parse(localStorage.getItem('categories_v3')) || {
  'MEDIANAS': [{name:'MED. POLLO', price:35},{name:'MED. PASTOR', price:35},{name:'MED. MIXTA', price:35}],
  'JUMBOS': [{name:'JUMB. POLLO', price:55},{name:'JUMB. PASTOR', price:55}],
  'TACOS': [{name:'TACOS POLLO', price:35},{name:'TACOS PASTOR', price:35}],
  'BEBIDAS': [{name:'AGUA PURA', price:10},{name:'COCA COLA', price:15}],
  'POSTRES_Y_EXTRAS': [{name:'CINAMON ROLL', price:20},{name:'ARROZ EN LECHE', price:20}]
};

let cart = [];
let discount = 0; 
let paymentMethod = 'EFECTIVO';
let orderCounter = Number(localStorage.getItem('order_counter') || 1);
function currentOrderLabel(){ return `A ${orderCounter}`; }

// helpers
const fmt = v=> 'Q'+(Number(v)||0).toFixed(2);
function recalc(){ const subtotal = cart.reduce((s,i)=>s + i.price*i.qty,0); const total = Math.max(0, subtotal - discount); document.getElementById('subtotal').textContent = fmt(subtotal); document.getElementById('discount').textContent = fmt(discount); document.getElementById('total').textContent = fmt(total); }

// RENDER
function renderCategories(){ const el=document.getElementById('categorias'); el.innerHTML=''; Object.keys(CATEGORIES).forEach(cat=>{ const b=document.createElement('button'); b.className='cat-btn cat-'+cat; b.textContent=cat; b.onclick=()=>showProducts(cat); el.appendChild(b); }); }
function showProducts(cat){ const el=document.getElementById('products'); el.innerHTML=''; CATEGORIES[cat].forEach(p=>{ const b=document.createElement('button'); b.className='prod-btn'; b.innerHTML=`<div class='prod-name'>${p.name}</div><div class='prod-price'>${fmt(p.price)}</div>`; b.onclick=()=> addProduct(p); el.appendChild(b); }); }
function renderViewer(){ document.getElementById('currentOrder').textContent = 'Orden: ' + currentOrderLabel(); const v=document.getElementById('viewer'); v.innerHTML=''; cart.forEach((it,i)=>{ const row=document.createElement('div'); row.className='item-row'; row.innerHTML = `<div style="flex:1"><b>${it.qty} x</b> ${it.name}</div><div style="width:140px;text-align:right">${fmt(it.price*it.qty)}</div>`; v.appendChild(row); }); recalc(); }
function saveCategories(){ localStorage.setItem('categories_v3', JSON.stringify(CATEGORIES)); }

// CART
function addProduct(p){ const qty=Number(document.getElementById('qty').value)||1; const existing=cart.find(c=>c.name===p.name); if(existing){ existing.qty+=qty; }else{ cart.push({name:p.name,price:p.price,qty}); } renderViewer(); }

// EVENTOS
document.getElementById('btnAddCategory').onclick = ()=>{
  const name = prompt('Nombre de la nueva categoría:');
  if(name){ CATEGORIES[name]=[]; saveCategories(); renderCategories(); }
};
document.getElementById('btnAddProduct').onclick = ()=>{
  const cat = prompt('Categoría del producto:'); if(!cat){ alert('Ingrese categoría'); return; }
  if(!CATEGORIES[cat]){ alert('Categoría no existe'); return; }
  const name = prompt('Nombre del producto:'); if(!name){ alert('Ingrese nombre'); return; }
  const price = parseFloat(prompt('Precio del producto:')); if(isNaN(price)){ alert('Precio inválido'); return; }
  CATEGORIES[cat].push({name,price}); saveCategories(); showProducts(cat);
};
document.getElementById('plus').onclick = ()=>{ document.getElementById('qty').stepUp(); }
document.getElementById('minus').onclick = ()=>{ document.getElementById('qty').stepDown(); }
document.getElementById('btnDeleteLast').onclick = ()=>{
  if(cart.length>0){ cart.pop(); renderViewer(); }
};
document.getElementById('coupon').onclick = ()=>{
  const d = parseFloat(prompt('Ingrese descuento Q')); if(!isNaN(d)){ discount=d; recalc(); }
};
document.getElementById('finalizar').onclick = ()=>{
  if(cart.length==0){ alert('No hay productos'); return; }
  saveSale(); cart=[]; discount=0; orderCounter++; localStorage.setItem('order_counter', orderCounter); renderViewer(); alert('Venta registrada y tickets generados'); 
};

// LOGIN
document.getElementById('btnLogin').onclick = ()=>{
  const u=document.getElementById('user').value; const p=document.getElementById('pass').value;
  if(u==='CAJERO' && p==='123'){ document.getElementById('login').style.display='none'; document.getElementById('appRoot').style.display='grid'; renderCategories(); }else{ alert('Usuario o clave incorrecta'); }
};

// VENTAS
function saveSale(){
  const history = JSON.parse(localStorage.getItem('sales_v3')||'[]');
  const total = cart.reduce((s,i)=>s+i.qty*i.price,0) - discount;
  history.push({id:orderCounter, items:cart, total, discount, method:paymentMethod, date:new Date().toLocaleString()});
  localStorage.setItem('sales_v3', JSON.stringify(history));
  renderHistory();
}
function renderHistory(){
  const hist = JSON.parse(localStorage.getItem('sales_v3')||'[]');
  const el = document.getElementById('history'); el.innerHTML='';
  hist.slice().reverse().forEach(h=>{
    const div=document.createElement('div'); div.className='row';
    div.textContent = `#${h.id} - Total: ${fmt(h.total)} (${h.method})`;
    div.onclick = ()=>{ alert(JSON.stringify(h.items,null,2)); };
    el.appendChild(div);
  });
}
document.getElementById('btnExport').onclick = ()=>{ const data=localStorage.getItem('sales_v3'); const blob=new Blob([data],{type:'application/json'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='ventas.json'; a.click(); }
document.getElementById('btnCloseShift').onclick = ()=>{
  const code = prompt('Ingrese código de cierre:'); if(code==='1234'){ localStorage.setItem('sales_v3','[]'); localStorage.setItem('order_counter','1'); alert('Cierre realizado y datos reseteados'); renderHistory(); orderCounter=1; }else{ alert('Código incorrecto'); }
}

// INIT
renderCategories(); renderHistory(); renderViewer();
</script>

</body>
</html>
